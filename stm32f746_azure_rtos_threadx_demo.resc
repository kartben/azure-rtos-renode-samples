:name: STM32F746
:description: This script runs the Azure RTOS ThreadX demo on STM32F746 Discovery.

using sysbus
$name?="STM32F746"
mach create $name

machine LoadPlatformDescription @platforms/boards/stm32f7_discovery-bb.repl
# machine StartGdbServer 3333

showAnalyzer usart1

cpu PerformanceInMips 462

# Home automation GUIX binary
$bin ?= @https://raw.githubusercontent.com/kartben/azure-rtos-renode-samples/master/stm32f746_threadx_demo.elf

# we silence the MPU warnings in nvic
logLevel 3 nvic

# we silence the warnings regarding tim6 since it's a basic timer and hence has lots of unsupported register fields compared to a normal timer
logLevel 3 timer6

macro reset
"""
    sysbus LoadELF $bin
    # sysbus LogAllPeripheralsAccess
    # sysbus LogPeripheralAccess sysbus.dma2d
    # sysbus.cpu LogFunctionNames True "stm32f746_24xrgb_buffer_toggle"
"""

runMacro $reset
